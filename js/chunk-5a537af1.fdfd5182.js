(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5a537af1"],{"5cc6":function(e,t,r){var i=r("74e8");i("Uint8",(function(e){return function(t,r,i){return e(this,t,r,i)}}))},"5e0f":function(e,t,r){"use strict";r.d(t,"a",(function(){return g})),r.d(t,"b",(function(){return v}));var i=r("d4ec"),n=r("22a2"),a=function e(t){Object(i["a"])(this,e),this.tileAnim=[0,0],this.dontUseTransform=!1,this.renderer=t,this.tileAnim=[0,0]},o=n["CanvasRenderer"];o&&o.registerPlugin("tilemap",a);r("fb6a"),r("ace4"),r("c0b6"),r("d3b7"),r("cfc3"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7");var s=r("bee2"),u=r("257e"),l=r("262e"),f=r("2caf"),h=r("9ac0"),d=r("c29d"),c=r("4ab2"),v={maxTextures:16,bufferSize:2048,boundSize:1024,boundCountPerBuffer:1,use32bitIndex:!1,SCALE_MODE:c["n"].LINEAR,DO_CLEAR:!0},b=(r("c19f"),r("fb2c"),r("45eb")),m=r("7e84"),x=r("d3fc"),p=12,y=function(e){Object(l["a"])(r,e);var t=Object(f["a"])(r);function r(e,n){var a;return Object(i["a"])(this,r),a=t.call(this),a.zIndex=0,a.modificationMarker=0,a._$_localBounds=new h["a"],a.shadowColor=new Float32Array([0,0,0,.5]),a._globalMat=null,a.pointsBuf=[],a.hasAnim=!1,a.offsetX=0,a.offsetY=0,a.compositeParent=!1,a.tileAnim=null,a.vbId=0,a.vb=null,a.vbBuffer=null,a.vbArray=null,a.vbInts=null,a.initialize(e,n),a}return Object(s["a"])(r,[{key:"initialize",value:function(e,t){t?t instanceof Array||!t.baseTexture||(t=[t]):t=[],this.textures=t,this.zIndex=e}},{key:"clear",value:function(){this.pointsBuf.length=0,this.modificationMarker=0,this._$_localBounds.clear(),this.hasAnim=!1}},{key:"addFrame",value:function(e,t,r,i,n){var a,o=0;if("number"===typeof e)o=e,a=this.textures[o];else{a="string"===typeof e?d["G"].from(e):e;for(var s=!1,u=this.textures,l=0;l<u.length;l++)if(u[l].baseTexture===a.baseTexture){o=l,s=!0;break}if(!s)return!1}return this.addRect(o,a.frame.x,a.frame.y,t,r,a.orig.width,a.orig.height,i,n,a.rotate),!0}},{key:"addRect",value:function(e,t,r,i,n,a,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1024,h=arguments.length>11&&void 0!==arguments[11]?arguments[11]:1024,d=this.pointsBuf;return this.hasAnim=this.hasAnim||s>0||u>0,d.push(t),d.push(r),d.push(i),d.push(n),d.push(a),d.push(o),d.push(l),d.push(0|s),d.push(0|u),d.push(e),d.push(f),d.push(h),this._$_localBounds.addFramePad(i,n,i+a,n+o,0,0),this}},{key:"tileRotate",value:function(e){var t=this.pointsBuf;t[t.length-3]=e}},{key:"tileAnimX",value:function(e,t){var r=this.pointsBuf;r[r.length-5]=e,r[r.length-2]=t}},{key:"tileAnimY",value:function(e,t){var r=this.pointsBuf;r[r.length-4]=e,r[r.length-1]=t}},{key:"renderCanvas",value:function(e){var t=e.plugins.tilemap;if(!t.dontUseTransform){var r=this.worldTransform;e.context.setTransform(r.a,r.b,r.c,r.d,r.tx*e.resolution,r.ty*e.resolution)}this.renderCanvasCore(e)}},{key:"renderCanvasCore",value:function(e){if(0!==this.textures.length){var t=this.pointsBuf,r=this.tileAnim||e.plugins.tilemap.tileAnim;e.context.fillStyle="#000000";for(var i=0,n=t.length;i<n;i+=p){var a=t[i],o=t[i+1],s=t[i+2],u=t[i+3],l=t[i+4],f=t[i+5];t[i+6];a+=t[i+7]*r[0],o+=t[i+8]*r[1];var h=t[i+9];h>=0?e.context.drawImage(this.textures[h].baseTexture.getDrawableSource(),a,o,l,f,s,u,l,f):(e.context.globalAlpha=.5,e.context.fillRect(s,u,l,f),e.context.globalAlpha=1)}}}},{key:"destroyVb",value:function(){this.vb&&(this.vb.destroy(),this.vb=null)}},{key:"render",value:function(e){var t=e.plugins["tilemap"],r=t.getShader();e.batch.setObjectRenderer(t),this._globalMat=r.uniforms.projTransMatrix,e.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),r.uniforms.shadowColor=this.shadowColor,r.uniforms.animationFrame=this.tileAnim||t.tileAnim,this.renderWebGLCore(e,t)}},{key:"renderWebGLCore",value:function(e,t){var r=this.pointsBuf;if(0!==r.length){var i=r.length/p,n=t.getShader(),a=this.textures;if(0!==a.length){t.bindTextures(e,n,a),e.shader.bind(n,!1);var o=this.vb;o||(o=t.createVb(),this.vb=o,this.vbId=o.id,this.vbBuffer=null,this.modificationMarker=0),t.checkIndexBuffer(i,o);var s=v.boundCountPerBuffer,u=o.getBuffer("aVertexPosition"),l=i*o.vertPerQuad;if(0!==l){if(this.modificationMarker!==l){this.modificationMarker=l;var f=o.stride*l;if(!this.vbBuffer||this.vbBuffer.byteLength<f){
//!@#$ happens, need resize
var h=o.stride;while(h<f)h*=2;this.vbBuffer=new ArrayBuffer(h),this.vbArray=new Float32Array(this.vbBuffer),this.vbInts=new Uint32Array(this.vbBuffer),u.update(this.vbBuffer)}for(var d=this.vbArray,b=(this.vbInts,0),m=0,y=this.offsetX,g=this.offsetY,T=0;T<r.length;T+=p){var A=.5;this.compositeParent&&(s>1?(m=r[T+9]>>2,y=this.offsetX*(1&r[T+9]),g=this.offsetY*(r[T+9]>>1&1)):(m=r[T+9],y=0,g=0));var w=r[T+2],k=r[T+3],C=r[T+4],S=r[T+5],B=r[T]+y,O=r[T+1]+g,j=r[T+6],_=r[T+7],z=r[T+8],M=r[T+10]||1024,I=r[T+11]||1024,L=_+2048*M,P=z+2048*I,R=void 0,F=void 0,D=void 0,E=void 0,Y=void 0,X=void 0,U=void 0,V=void 0;if(0===j)R=B,F=O,D=B+C,E=O,Y=B+C,X=O+S,U=B,V=O+S;else{var G=C/2,W=S/2;j%4!==0&&(G=S/2,W=C/2);var N=B+G,$=O+W;j=x["n"].add(j,x["n"].NW),R=N+G*x["n"].uX(j),F=$+W*x["n"].uY(j),j=x["n"].add(j,2),D=N+G*x["n"].uX(j),E=$+W*x["n"].uY(j),j=x["n"].add(j,2),Y=N+G*x["n"].uX(j),X=$+W*x["n"].uY(j),j=x["n"].add(j,2),U=N+G*x["n"].uX(j),V=$+W*x["n"].uY(j)}d[b++]=w,d[b++]=k,d[b++]=R,d[b++]=F,d[b++]=B+A,d[b++]=O+A,d[b++]=B+C-A,d[b++]=O+S-A,d[b++]=L,d[b++]=P,d[b++]=m,d[b++]=w+C,d[b++]=k,d[b++]=D,d[b++]=E,d[b++]=B+A,d[b++]=O+A,d[b++]=B+C-A,d[b++]=O+S-A,d[b++]=L,d[b++]=P,d[b++]=m,d[b++]=w+C,d[b++]=k+S,d[b++]=Y,d[b++]=X,d[b++]=B+A,d[b++]=O+A,d[b++]=B+C-A,d[b++]=O+S-A,d[b++]=L,d[b++]=P,d[b++]=m,d[b++]=w,d[b++]=k+S,d[b++]=U,d[b++]=V,d[b++]=B+A,d[b++]=O+A,d[b++]=B+C-A,d[b++]=O+S-A,d[b++]=L,d[b++]=P,d[b++]=m}u.update(d)}e.geometry.bind(o,n),e.geometry.draw(c["e"].TRIANGLES,6*i,0)}}}}},{key:"isModified",value:function(e){return!!(this.modificationMarker!==this.pointsBuf.length||e&&this.hasAnim)}},{key:"clearModify",value:function(){this.modificationMarker=this.pointsBuf.length}},{key:"_calculateBounds",value:function(){var e=this._$_localBounds,t=e.minX,r=e.minY,i=e.maxX,n=e.maxY;this._bounds.addFrame(this.transform,t,r,i,n)}},{key:"getLocalBounds",value:function(e){return 0===this.children.length?this._$_localBounds.getRectangle(e):Object(b["a"])(Object(m["a"])(r.prototype),"getLocalBounds",this).call(this,e)}},{key:"destroy",value:function(e){Object(b["a"])(Object(m["a"])(r.prototype),"destroy",this).call(this,e),this.destroyVb()}}]),r}(h["b"]),g=function(e){Object(l["a"])(r,e);var t=Object(f["a"])(r);function r(e,n,a){var o;return Object(i["a"])(this,r),o=t.call(this),o.modificationMarker=0,o.shadowColor=new Float32Array([0,0,0,.5]),o._globalMat=null,o._lastLayer=null,o.tileAnim=null,o.initialize.apply(Object(u["a"])(o),arguments),o}return Object(s["a"])(r,[{key:"initialize",value:function(e,t,r){!0===r&&(r=0),this.z=this.zIndex=e,this.texPerChild=r||v.boundCountPerBuffer*v.maxTextures,t&&this.setBitmaps(t)}},{key:"setBitmaps",value:function(e){for(var t=0;t<e.length;t++)if(e[t]&&!e[t].baseTexture)throw new Error("pixi-tilemap cannot use destroyed textures. Probably, you passed resources['myAtlas'].texture in pixi > 5.2.1, it does not exist there.");var r,i=this.texPerChild,n=this.children.length,a=Math.ceil(e.length/i);for(r=0;r<n;r++)this.children[r].textures=e.slice(r*i,(r+1)*i);for(r=n;r<a;r++){var o=new y(this.zIndex,e.slice(r*i,(r+1)*i));o.compositeParent=!0,o.offsetX=v.boundSize,o.offsetY=v.boundSize,this.addChild(o)}}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++)this.children[e].clear();this.modificationMarker=0}},{key:"addRect",value:function(e,t,r,i,n,a,o,s,u,l,f,h){var d=e/this.texPerChild>>0,c=e%this.texPerChild;return this.children[d]&&this.children[d].textures?(this._lastLayer=this.children[d],this._lastLayer.addRect(c,t,r,i,n,a,o,s,u,l,f,h)):this._lastLayer=null,this}},{key:"tileRotate",value:function(e){return this._lastLayer&&this._lastLayer.tileRotate(e),this}},{key:"tileAnimX",value:function(e,t){return this._lastLayer&&this._lastLayer.tileAnimX(e,t),this}},{key:"tileAnimY",value:function(e,t){return this._lastLayer&&this._lastLayer.tileAnimY(e,t),this}},{key:"addFrame",value:function(e,t,r,i,n,a,o){var s,u=null,l=0,f=this.children;if(this._lastLayer=null,"number"===typeof e){var h=e/this.texPerChild>>0;if(u=f[h],u)l=e%this.texPerChild;else{if(u=f[0],!u)return this;l=0}s=u.textures[l]}else{s="string"===typeof e?d["G"].from(e):e;for(var c=0;c<f.length;c++){for(var b=f[c],m=b.textures,x=0;x<m.length;x++)if(m[x].baseTexture===s.baseTexture){u=b,l=x;break}if(u)break}if(!u){for(var p=0;p<f.length;p++){var g=f[p];if(g.textures.length<this.texPerChild){u=g,l=g.textures.length,g.textures.push(s);break}}u||(u=new y(this.zIndex,s),u.compositeParent=!0,u.offsetX=v.boundSize,u.offsetY=v.boundSize,this.addChild(u),l=0)}}return this._lastLayer=u,u.addRect(l,s.frame.x,s.frame.y,t,r,s.orig.width,s.orig.height,i,n,s.rotate,a,o),this}},{key:"renderCanvas",value:function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){var t=e.plugins.tilemap;if(!t.dontUseTransform){var r=this.worldTransform;e.context.setTransform(r.a,r.b,r.c,r.d,r.tx*e.resolution,r.ty*e.resolution)}for(var i=this.children,n=0;n<i.length;n++){var a=i[n];a.tileAnim=this.tileAnim,a.renderCanvasCore(e)}}}},{key:"render",value:function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){var t=e.plugins["tilemap"],r=t.getShader();e.batch.setObjectRenderer(t),this._globalMat=r.uniforms.projTransMatrix,e.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),r.uniforms.shadowColor=this.shadowColor,r.uniforms.animationFrame=this.tileAnim||t.tileAnim,e.shader.bind(r,!1);for(var i=this.children,n=0;n<i.length;n++){var a=i[n];a.renderWebGLCore(e,t)}}}},{key:"isModified",value:function(e){var t=this.children;if(this.modificationMarker!==t.length)return!0;for(var r=0;r<t.length;r++)if(t[r].isModified(e))return!0;return!1}},{key:"clearModify",value:function(){var e=this.children;this.modificationMarker=e.length;for(var t=0;t<e.length;t++)e[t].clearModify()}}]),r}(h["b"]),T=r("67af"),A=(T["c"],r("5cc6"),r("7eaa")),w=function(e){Object(l["a"])(r,e);var t=Object(f["a"])(r);function r(e){var n;Object(i["a"])(this,r),n=t.call(this,e.bufferSize,e.bufferSize),n.DO_CLEAR=!1,n.boundSize=0,n._clearBuffer=null,n.baseTex=null,n.boundSprites=[],n.dirties=[];var a=n.boundSprites,o=n.dirties;n.boundSize=e.boundSize;for(var s=0;s<e.boundCountPerBuffer;s++){var u=new A["a"];u.position.x=e.boundSize*(1&s),u.position.y=e.boundSize*(s>>1),a.push(u),o.push(0)}return n.DO_CLEAR=!!e.DO_CLEAR,n}return Object(s["a"])(r,[{key:"bind",value:function(e){if(this.baseTex)throw new Error("Only one baseTexture is allowed for this resource!");this.baseTex=e,Object(b["a"])(Object(m["a"])(r.prototype),"bind",this).call(this,e)}},{key:"setTexture",value:function(e,t){var r=this.boundSprites[e];r.texture.baseTexture!==t.baseTexture&&(r.texture=t,this.baseTex.update(),this.dirties[e]=this.baseTex.dirtyId)}},{key:"upload",value:function(e,t,r){var i=e.gl,n=this.width,a=this.height;i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,void 0===t.alphaMode||t.alphaMode===c["a"].UNPACK),r.dirtyId<0&&(r.width=n,r.height=a,i.texImage2D(t.target,0,t.format,n,a,0,t.format,t.type,null));var o=this.DO_CLEAR;o&&!this._clearBuffer&&(this._clearBuffer=new Uint8Array(v.boundSize*v.boundSize*4));for(var s=this.boundSprites,u=0;u<s.length;u++){var l=s[u],f=l.texture.baseTexture;if(!(r.dirtyId>=this.dirties[u])){var h=f.resource;f.valid&&h&&h.source&&(o&&(f.width<this.boundSize||f.height<this.boundSize)&&i.texSubImage2D(t.target,0,l.position.x,l.position.y,this.boundSize,this.boundSize,t.format,t.type,this._clearBuffer),i.texSubImage2D(t.target,0,l.position.x,l.position.y,t.format,t.type,h.source))}}return!0}}]),r}(d["P"].Resource);r("ac1f"),r("5319");function k(e,t){for(var r=[],i=0;i<t;i++)r[i]=i;e.uniforms.uSamplers=r;for(var n=[],a=0;a<t;a++)n.push(1/v.bufferSize),n.push(1/v.bufferSize);e.uniforms.uSamplerSize=n}function C(e,t){return t.replace(/%count%/gi,e+"").replace(/%forloop%/gi,S(e))}function S(e){var t="";t+="\n",t+="\n",t+="if(vTextureId <= -1.0) {",t+="\n\tcolor = shadowColor;",t+="\n}";for(var r=0;r<e;r++)t+="\nelse ",r<e-1&&(t+="if(textureId == "+r+".0)"),t+="\n{",t+="\n\tcolor = texture2D(uSamplers["+r+"], textureCoord * uSamplerSize["+r+"]);",t+="\n}";return t+="\n",t+="\n",t}var B="\nvarying vec2 vTextureCoord;\nvarying vec4 vFrame;\nvarying float vTextureId;\nuniform vec4 shadowColor;\nuniform sampler2D uSamplers[%count%];\nuniform vec2 uSamplerSize[%count%];\n\nvoid main(void){\n   vec2 textureCoord = clamp(vTextureCoord, vFrame.xy, vFrame.zw);\n   float textureId = floor(vTextureId + 0.5);\n\n   vec4 color;\n   %forloop%\n   gl_FragColor = color;\n}\n",O="\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aFrame;\nattribute vec2 aAnim;\nattribute float aTextureId;\n\nuniform mat3 projTransMatrix;\nuniform vec2 animationFrame;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vFrame;\n\nvoid main(void){\n   gl_Position = vec4((projTransMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vec2 animCount = floor((aAnim + 0.5) / 2048.0);\n   vec2 animFrameOffset = aAnim - animCount * 2048.0;\n   vec2 animOffset = animFrameOffset * floor(mod(animationFrame + 0.5, animCount));\n\n   vTextureCoord = aTextureCoord + animOffset;\n   vFrame = aFrame + vec4(animOffset, animOffset);\n   vTextureId = aTextureId;\n}\n",j=function(e){Object(l["a"])(r,e);var t=Object(f["a"])(r);function r(e,n,a){var o;return Object(i["a"])(this,r),o=t.call(this,new d["w"](n,a),{animationFrame:new Float32Array(2),uSamplers:[],uSamplerSize:[],projTransMatrix:new x["d"]}),o.maxTextures=0,o.maxTextures=e,k(Object(u["a"])(o),o.maxTextures),o}return r}(d["C"]),_=function(e){Object(l["a"])(r,e);var t=Object(f["a"])(r);function r(e){var n;return Object(i["a"])(this,r),n=t.call(this,e,O,C(e,B)),k(Object(u["a"])(n),n.maxTextures),n}return r}(j),z=function(e){Object(l["a"])(r,e);var t=Object(f["a"])(r);function r(){var e;Object(i["a"])(this,r),e=t.call(this),e.vertSize=11,e.vertPerQuad=4,e.stride=4*e.vertSize,e.lastTimeAccess=0;var n=e.buf=new d["l"](new Float32Array(2),!0,!1);return e.addAttribute("aVertexPosition",n,0,!1,0,e.stride,0).addAttribute("aTextureCoord",n,0,!1,0,e.stride,8).addAttribute("aFrame",n,0,!1,0,e.stride,16).addAttribute("aAnim",n,0,!1,0,e.stride,32).addAttribute("aTextureId",n,0,!1,0,e.stride,40),e}return r}(d["s"]),M=(r("6eba"),r("0d03"),function(e){Object(l["a"])(r,e);var t=Object(f["a"])(r);function r(e){var n;return Object(i["a"])(this,r),n=t.call(this,e),n.sn=-1,n.indexBuffer=null,n.ibLen=0,n.tileAnim=[0,0],n.texLoc=[],n.texResources=[],n.rectShader=new _(v.maxTextures),n.indexBuffer=new d["l"](void 0,!0,!0),n.checkIndexBuffer(2e3),n.initBounds(),n}return Object(s["a"])(r,[{key:"initBounds",value:function(){if(!(v.boundCountPerBuffer<=1))for(var e=v.maxTextures,t=0;t<e;t++){var r=new w(v),i=new d["e"](r);i.scaleMode=v.SCALE_MODE,i.wrapMode=c["q"].CLAMP,this.texResources.push(r)}}},{key:"bindTexturesWithoutRT",value:function(e,t,r){var i=t.uniforms.uSamplerSize;this.texLoc.length=0;for(var n=0;n<r.length;n++){var a=r[n];if(!a||!a.valid)return;e.texture.bind(r[n],n),i[2*n]=1/r[n].baseTexture.width,i[2*n+1]=1/r[n].baseTexture.height}t.uniforms.uSamplerSize=i}},{key:"bindTextures",value:function(e,t,r){var i=r.length,n=v.maxTextures;if(!(i>v.boundCountPerBuffer*n))if(v.boundCountPerBuffer<=1)this.bindTexturesWithoutRT(e,t,r);else{for(var a=0;a<i;a++){var o=r[a];if(o&&o.valid){var s=this.texResources[a>>2];s.setTexture(3&a,o)}}var u=a+3>>2;for(a=0;a<u;a++)e.texture.bind(this.texResources[a].baseTex,a)}}},{key:"start",value:function(){}},{key:"createVb",value:function(){var e=new z;return e.addIndex(this.indexBuffer),e.lastTimeAccess=Date.now(),e}},{key:"checkIndexBuffer",value:function(e){var t=6*e;if(!(t<=this.ibLen)){var r=t;while(r<t)r<<=1;this.ibLen=t,this.indexBuffer.update(n["utils"].createIndicesForQuads(e,v.use32bitIndex?new Uint32Array(6*e):void 0))}}},{key:"getShader",value:function(){return this.rectShader}},{key:"destroy",value:function(){Object(b["a"])(Object(m["a"])(r.prototype),"destroy",this).call(this),this.rectShader=null}}]),r}(d["v"]));d["B"].registerPlugin("tilemap",M);h["b"]},"6eba":function(e,t,r){var i=r("23e7");i({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}})},c19f:function(e,t,r){"use strict";var i=r("23e7"),n=r("da84"),a=r("621a"),o=r("2626"),s="ArrayBuffer",u=a[s],l=n[s];i({global:!0,forced:l!==u},{ArrayBuffer:u}),o(s)},fb2c:function(e,t,r){var i=r("74e8");i("Uint32",(function(e){return function(t,r,i){return e(this,t,r,i)}}))}}]);
//# sourceMappingURL=chunk-5a537af1.fdfd5182.js.map