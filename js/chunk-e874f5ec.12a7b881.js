(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e874f5ec"],{"0820":function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{position:"relative"}},[i("div",{ref:"pixi_area",staticStyle:{width:"640px",height:"480px"}}),i("div",{staticStyle:{position:"absolute",left:"4px",top:"4px",color:"#fff"}},[e._v(e._s((1e3/e.fpsCounter.averageMs).toFixed(2))+" fps")])])},a=[],n=(i("d3b7"),i("6062"),i("3ca3"),i("ddb0"),i("d4ec")),s=i("bee2"),o=i("2b0e"),h=i("22a2"),c=(i("18a5"),i("3835")),d=i("262e"),u=i("2caf"),p=i("426a"),l=function e(t,i,r){Object(n["a"])(this,e),this.moveX=t,this.moveY=i,this.nextDirection=r},f=function(){function e(t,i,r){Object(n["a"])(this,e),this.textureOffset=i,this.routine=r,this.x=0,this.y=0,this.hitCircle=new h["Circle"](0,0,12),this.hitRect=new h["Rectangle"](-12,-12,24,24),this.animationFrame=0,this._currentDirection=2,this.preUpdateInfo=null,this.animationStep=0,this.bodySprite=new p["a"],this.bodySprite.texture=new h["Texture"](t.baseTexture,new h["Rectangle"](i.x,i.y,32,64)),r.character=this,this.bodySprite.anchor.set(.5,1);var a=new h["Texture"](t.baseTexture,new h["Rectangle"](224,96,32,32));this.shadowSprite=h["Sprite"].from(a),this.shadowSprite.alpha=.5,this.shadowSprite.anchor.set(.5,.5),this.debugCircle=new h["Graphics"],this.debugCircle.lineStyle(2,16733525,1),this.debugCircle.alpha=.7,this.debugCircle.drawCircle(0,0,11),this.debugRect=new h["Graphics"],this.debugRect.lineStyle(2,5592575,1),this.debugRect.alpha=.7,this.debugRect.drawRect(this.hitRect.x,this.hitRect.y,this.hitRect.width,this.hitRect.height)}return Object(s["a"])(e,[{key:"currentDirection",get:function(){return this._currentDirection},set:function(e){this._currentDirection=e,this.syncTexture()}},{key:"syncTexture",value:function(){var e=0,t=0;switch(this.currentDirection){case 1:e=96;break;case 2:break;case 3:e=96,t=64;break;case 4:t=64;break;case 6:t=128;break;case 7:e=96,t=128;break;case 8:t=192;break;case 9:e=96,t=192;break}e+=32*(3===this.animationStep?1:this.animationStep);var i=new h["Rectangle"](this.textureOffset.x+e,this.textureOffset.y+t,32,64);this.bodySprite.texture.frame=i}},{key:"preUpdate",value:function(){this.routine.preUpdate()}},{key:"update",value:function(){var e=[this.x,this.y+8];this.bodySprite.x=e[0],this.bodySprite.y=e[1];var t=[this.x,this.y];this.shadowSprite.x=t[0],this.shadowSprite.y=t[1];var i=[this.x,this.y];this.hitCircle.x=i[0],this.hitCircle.y=i[1];var r=[this.x,this.y];this.debugCircle.x=r[0],this.debugCircle.y=r[1];var a=[this.x-12,this.y-12];this.hitRect.x=a[0],this.hitRect.y=a[1];var n=[this.x,this.y];this.debugRect.x=n[0],this.debugRect.y=n[1],this.bodySprite.zOrder=this.bodySprite.position.y,++this.animationFrame,this.animationFrame>30&&(this.animationFrame=0,this.animationStep=(this.animationStep+1)%4,this.syncTexture())}}]),e}(),g=function e(){Object(n["a"])(this,e)},v=function(e,t){var i=.7*t;switch(e){case 1:return[-i,i];case 2:return[0,t];case 3:return[i,i];case 4:return[-t,0];case 6:return[t,0];case 7:return[-i,-i];case 8:return[0,-t];case 9:return[i,-i]}return[0,0]},m=function(e){Object(d["a"])(i,e);var t=Object(u["a"])(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;return Object(n["a"])(this,i),e=t.call(this),e.isMoving=r,e.frameCountToWait=a,e.frameCountToMove=s,e}return Object(s["a"])(i,[{key:"preUpdate",value:function(){if(this.isMoving){var e=v(this.character.currentDirection,.6),t=Object(c["a"])(e,2),i=t[0],r=t[1];this.character.preUpdateInfo=new l(i,r,this.character.currentDirection),--this.frameCountToWait,this.frameCountToWait<=0&&(this.frameCountToWait=0,this.frameCountToMove=60+30*Math.floor(3*Math.random()),this.isMoving=!1)}else if(--this.frameCountToMove,this.frameCountToMove<=0){this.frameCountToMove=0,this.frameCountToWait=60;var a=[1,2,3,4,6,7,8,9][Math.floor(8*Math.random())];this.character.preUpdateInfo=new l(0,0,a),this.isMoving=!0}}}]),i}(g),b=(i("4160"),i("45fc"),i("4ec9"),i("159b"),i("d820")),y=i("5e0f"),w=function(e){Object(d["a"])(i,e);var t=Object(u["a"])(i);function i(e){var r;Object(n["a"])(this,i),r=t.call(this),r.texture=e,r.step=0,r.horizontalGridNum=200,r.verticalGridNum=200,r.targetCharacter=null,r.characters=[],r.walls=[],r.textureMap=new Map,y["b"].use32bitIndex=!0,r.sortableChildren=!0,r.bgLayerContainer=new y["a"](0,[e]),r.layerContainer=new b["a"](2e4,{uvs:!0,vertices:!0,tint:!0}),r.airLayerContainer=new y["a"](0,[e]),r.debugLayerContainer=new h["Container"],r.debugLayerContainer.visible=!1,r.addChild(r.bgLayerContainer),r.addChild(r.layerContainer),r.addChild(r.airLayerContainer),r.addChild(r.debugLayerContainer),r.textureMap.set("field",e.clone()),r.textureMap.get("field").frame=new h["Rectangle"](0,0,16,16);for(var a=0;a<r.verticalGridNum;++a)for(var s=0;s<r.horizontalGridNum;++s)r.bgLayerContainer.addFrame(r.textureMap.get("field"),16*s,16*a);r.textureMap.set("treeUp",e.clone()),r.textureMap.set("treeDown",e.clone()),r.textureMap.get("treeUp").frame=new h["Rectangle"](32,0,64,32),r.textureMap.get("treeDown").frame=new h["Rectangle"](32,32,64,48);for(var o=0;o<r.verticalGridNum;++o)for(var c=0;c<r.horizontalGridNum;++c)Math.random()<.02&&r.addTree(c,o);return r.addWall(new h["Rectangle"](-16,0,16,16*r.verticalGridNum)),r.addWall(new h["Rectangle"](16*r.horizontalGridNum,0,16,16*r.verticalGridNum)),r.addWall(new h["Rectangle"](0,-16,16*r.horizontalGridNum,16)),r.addWall(new h["Rectangle"](16,16*r.verticalGridNum,16*r.horizontalGridNum-32,16)),r.on("added",(function(){})),r}return Object(s["a"])(i,[{key:"addTree",value:function(e,t){this.airLayerContainer.addFrame(this.textureMap.get("treeUp"),16*e,16*t),this.bgLayerContainer.addFrame(this.textureMap.get("treeDown"),16*e,16*t+32),this.addWall(new h["Rectangle"](16*e,16*t+32-2,64,40))}},{key:"addWall",value:function(e){this.walls.push(e);var t=new h["Graphics"];t.lineStyle(2,5592575,1),t.drawRect(e.x+1,e.y+1,e.width-2,e.height-2),this.debugLayerContainer.addChild(t)}},{key:"addCharacter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.characters.push(e),t&&(this.targetCharacter=e),this.layerContainer.addChildZ(e.bodySprite,1),this.layerContainer.addChildZ(e.shadowSprite,1),this.debugLayerContainer.addChild(e.debugCircle),this.debugLayerContainer.addChild(e.debugRect)}},{key:"update",value:function(){this.characters.forEach((function(e){return e.preUpdate()})),this.characters.forEach((function(e){if(null!=e.preUpdateInfo){var t=[e.preUpdateInfo.moveX,e.preUpdateInfo.moveY],i=t[0],r=t[1];e.x+=i,e.y+=r,e.currentDirection=e.preUpdateInfo.nextDirection,e.preUpdateInfo=null}e.update()}));var e=4;switch(this.step){case 0:this.x-=e,this.x<=-(16*this.horizontalGridNum-640)&&(this.step=1);break;case 1:this.y-=e,this.y<=-(16*this.verticalGridNum-480)&&(this.step=2);break;case 2:this.x+=e,this.x>=0&&(this.step=3);break;case 3:this.y+=e,this.y>=0&&(this.step=0);break}this.layerContainer.sortChildren()}},{key:"hitOtherCaracter",value:function(e,t,i){var r=e.hitCircle.clone();r.x+=t,r.y+=i;var a=0,n=this.characters.some((function(t){if(e===t)return!1;var i=[r.x,r.y,t.hitCircle.x,t.hitCircle.y],n=i[0],s=i[1],o=i[2],h=i[3];a=r.radius+t.hitCircle.radius-Math.sqrt(Math.pow(o-n,2)+Math.pow(h-s,2));var c=a>=0;return c}));return[n,n?a/Math.sqrt(Math.pow(t,2)+Math.pow(i,2)):0]}},{key:"hitWall",value:function(e,t,i){var r=e.hitRect.clone();r.x+=t,r.y+=i;var a=0,n=0,s=this.walls.some((function(e){var s=r.left<e.right&&r.right>e.left,o=r.top<e.bottom&&r.bottom>e.top,h=s&&o;return h&&(t<0?a=r.left-e.right:t>0&&(a=r.right-e.left),i<0?n=r.top-e.bottom:i>0&&(n=r.bottom-e.top)),h}));return[s,a,n]}},{key:"setDebugMode",value:function(e){this.debugLayerContainer.visible=e}}]),i}(h["Container"]),x=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now();Object(n["a"])(this,e),this.oldNow=t,this.ms=0,this.counter=0,this.averageMs=0}return Object(s["a"])(e,[{key:"checkPoint",value:function(){var e=performance.now();this.ms+=e-this.oldNow,this.oldNow=e,++this.counter,this.counter>=60&&(this.averageMs=this.ms/this.counter,this.counter=0,this.ms=0)}}]),e}(),C=o["default"].extend({data:function(){return{pixiApp:null,field:null,pressedKeyCodeSet:new Set,fpsCounter:new x,npc:null,isDebugMode:!1}},mounted:function(){var e=this;h["settings"].RESOLUTION=window.devicePixelRatio,h["settings"].SCALE_MODE=h["SCALE_MODES"].NEAREST,window.onkeydown=this.onKeyDown,window.onkeyup=this.onKeyUp;var t={width:640,height:480};this.pixiApp=new h["Application"](t),this.pixiApp.ticker.maxFPS=60,this.pixiApp.ticker.minFPS=60;var i=this.$refs["pixi_area"];i.appendChild(this.pixiApp.view);var r=new h["Sprite"](h["Texture"].WHITE);r.width=320,r.height=240,r.tint=13421772,this.pixiApp.stage.addChild(r),h["utils"].clearTextureCache(),h["Loader"].shared.reset().add("/arpg-sample/images/stages/009/chara01.png").add("/arpg-sample/images/stages/009/chara02.png").add("/arpg-sample/images/stages/009/mapchip.png").load((function(){var t=h["RenderTexture"].create({width:512,height:512}),i=(h["Sprite"].from(t),h["Sprite"].from(h["Loader"].shared.resources["/arpg-sample/images/stages/009/mapchip.png"].texture));e.pixiApp.renderer.render(i,t,!1);var r=h["Sprite"].from(h["Loader"].shared.resources["/arpg-sample/images/stages/009/chara01.png"].texture);r.position.set(0,128),e.pixiApp.renderer.render(r,t,!1);var a=h["Sprite"].from(h["Loader"].shared.resources["/arpg-sample/images/stages/009/chara02.png"].texture);a.position.set(192,128),e.pixiApp.renderer.render(a,t,!1),e.field=new w(t),e.pixiApp.stage.addChild(e.field);for(var n=0;n<200;++n)e.npc=new f(t,Math.random()<.5?new h["Point"](0,128):new h["Point"](192,128),new m),e.npc.x=16+16*Math.floor(Math.random()*(e.field.horizontalGridNum-2)),e.npc.y=16+16*Math.floor(Math.random()*(e.field.verticalGridNum-2)),e.npc.currentDirection=4,e.field.addCharacter(e.npc)})),this.pixiApp.ticker.add(this.update)},methods:{onKeyDown:function(e){this.pressedKeyCodeSet.add(e.keyCode)},onKeyUp:function(e){this.pressedKeyCodeSet["delete"](e.keyCode)},update:function(e){this.fpsCounter.checkPoint(),null!=this.field&&this.field.update()},onClickToggleDebugMode:function(){this.isDebugMode=!this.isDebugMode,this.field.setDebugMode(this.isDebugMode)}},beforeDestroy:function(){this.pixiApp.destroy(!0)},components:{},computed:{},props:[]}),M=C,S=(i("6b43"),i("2877")),k=Object(S["a"])(M,r,a,!1,null,"09c39829",null);t["default"]=k.exports},"45fc":function(e,t,i){"use strict";var r=i("23e7"),a=i("b727").some,n=i("a640"),s=i("ae40"),o=n("some"),h=s("some");r({target:"Array",proto:!0,forced:!o||!h},{some:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},"4ec9":function(e,t,i){"use strict";var r=i("6d61"),a=i("6566");e.exports=r("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),a)},"6b43":function(e,t,i){"use strict";i("c37d")},c37d:function(e,t,i){}}]);
//# sourceMappingURL=chunk-e874f5ec.12a7b881.js.map