(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-42beaf9a"],{1219:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));i("a630"),i("d3b7"),i("6062"),i("3ca3"),i("ddb0");var r=i("d4ec"),a=i("bee2"),s=function(){function t(){Object(r["a"])(this,t),this.lastPressedKeyCodeSet=new Set,this.nowPressedKeyCodeSet=new Set}return Object(a["a"])(t,[{key:"onKeyDown",value:function(t){this.nowPressedKeyCodeSet.add(t)}},{key:"onKeyUp",value:function(t){this.nowPressedKeyCodeSet["delete"](t)}},{key:"endTurn",value:function(){this.lastPressedKeyCodeSet=new Set(Array.from(this.nowPressedKeyCodeSet))}},{key:"isPressing",value:function(t){return this.nowPressedKeyCodeSet.has(t)}},{key:"isPressed",value:function(t){return this.nowPressedKeyCodeSet.has(t)&&!this.lastPressedKeyCodeSet.has(t)}},{key:"isReleased",value:function(t){return!this.nowPressedKeyCodeSet.has(t)&&this.lastPressedKeyCodeSet.has(t)}},{key:"reset",value:function(){this.lastPressedKeyCodeSet.clear(),this.nowPressedKeyCodeSet.clear()}}]),t}()},"2ea5":function(t,e,i){"use strict";i("49e8")},"45fc":function(t,e,i){"use strict";var r=i("23e7"),a=i("b727").some,s=i("a640"),h=i("ae40"),n=s("some"),o=h("some");r({target:"Array",proto:!0,forced:!n||!o},{some:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}})},"49e8":function(t,e,i){},"4de4":function(t,e,i){"use strict";var r=i("23e7"),a=i("b727").filter,s=i("1dde"),h=i("ae40"),n=s("filter"),o=h("filter");r({target:"Array",proto:!0,forced:!n||!o},{filter:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}})},"4ec9":function(t,e,i){"use strict";var r=i("6d61"),a=i("6566");t.exports=r("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),a)},"8c9f":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{position:"relative"}},[i("div",{ref:"pixi_area",staticStyle:{width:"640px",height:"480px"}}),i("div",{staticStyle:{position:"absolute",left:"4px",top:"4px",color:"#fff"}},[t._v(t._s((1e3/t.fpsCounter.averageMs).toFixed(2))+" fps")])])},a=[],s=(i("4de4"),i("4160"),i("159b"),i("3835")),h=i("d4ec"),n=i("bee2"),o=i("2b0e"),c=i("22a2"),d=(i("4ec9"),i("d3b7"),i("3ca3"),i("18a5"),i("ddb0"),i("262e")),u=i("2caf"),l=i("426a"),f=function t(e,i,r){Object(h["a"])(this,t),this.moveX=e,this.moveY=i,this.nextDirection=r},p=function t(e,i,r,a,s){Object(h["a"])(this,t),this.texture=e,this.offset=i,this.width=r,this.height=a,this.directionNum=s};function g(t){return t*(Math.PI/180)}var m=new Map([[8,0],[9,g(45)],[6,g(90)],[3,g(135)],[2,g(180)],[1,g(225)],[4,g(270)],[7,g(315)]]),y=new Map([[8,new c["Point"](0,-1)],[9,new c["Point"](.7,-.7)],[6,new c["Point"](1,0)],[3,new c["Point"](.7,.7)],[2,new c["Point"](0,1)],[1,new c["Point"](-.7,.7)],[4,new c["Point"](-1,0)],[7,new c["Point"](-.7,-.7)]]),C=function(){function t(e){Object(h["a"])(this,t),this.textureInfo=e,this.frameCount=-1,this.isAttacking=!1,this.attackCircles=[],this.attackCircleGraphics=[],this.sprite=new l["a"],this.sprite.texture=new c["Texture"](e.texture.baseTexture,new c["Rectangle"](e.offset.x,e.offset.y,e.width,e.height)),this.sprite.anchor.set(.5,.5)}return Object(n["a"])(t,[{key:"onAddToField",value:function(){this.isAttacking=!0,this.frameCount=0;var e=y.get(this.character.currentDirection),i=[this.character.x+e.x*t.DISTANCE,this.character.y+e.y*t.DISTANCE-t.HIT_OFFSET_Y];this.sprite.position.x=i[0],this.sprite.position.y=i[1],this.sprite.texture.frame=new c["Rectangle"](this.textureInfo.offset.x,this.textureInfo.offset.y,this.textureInfo.width,this.textureInfo.height),this.sprite.rotation=m.get(this.character.currentDirection),this.field.layerContainer.addChildZ(this.sprite,0),this.sprite.zOrder=this.sprite.y}},{key:"onRemoveFromField",value:function(){this.isAttacking=!1,this.field.layerContainer.removeChild(this.sprite)}},{key:"update",value:function(){var e=this;if(!(this.frameCount<0)){if(5===this.frameCount)this.sprite.texture.frame=new c["Rectangle"](this.textureInfo.offset.x+this.textureInfo.width,this.textureInfo.offset.y,this.textureInfo.width,this.textureInfo.height);else if(10===this.frameCount){this.attackCircles.push(new c["Circle"](0,0,5));var i=new c["Graphics"];i.lineStyle(2,5635925,1),i.alpha=.7,i.drawCircle(0,0,5),i.position.set(this.sprite.x,this.sprite.y+t.HIT_OFFSET_Y),this.attackCircleGraphics.push(i),this.field.debugLayerContainer.addChild(i),this.sprite.texture.frame=new c["Rectangle"](this.textureInfo.offset.x+2*this.textureInfo.width,this.textureInfo.offset.y,this.textureInfo.width,this.textureInfo.height)}else if(15===this.frameCount)this.sprite.texture.frame=new c["Rectangle"](this.textureInfo.offset.x+3*this.textureInfo.width,this.textureInfo.offset.y,this.textureInfo.width,this.textureInfo.height),this.attackCircleGraphics.forEach((function(t){return e.field.debugLayerContainer.removeChild(t)}));else if(20===this.frameCount)this.sprite.texture.frame=new c["Rectangle"](this.textureInfo.offset.x+4*this.textureInfo.width,this.textureInfo.offset.y,this.textureInfo.width,this.textureInfo.height);else if(25===this.frameCount)return this.field.layerContainer.removeChild(this.sprite),this.frameCount=-1,void this.onRemoveFromField();++this.frameCount}}}]),t}();C.HIT_OFFSET_Y=10,C.DISTANCE=26;var v=function(){function t(e,i){Object(h["a"])(this,t),this.textureInfo=e,this.field=i,this.x=0,this.y=0,this.hitCircle=new c["Circle"](0,0,12),this.hitRect=new c["Rectangle"](-12,-12,24,24),this.animationFrame=0,this._currentDirection=2,this.preUpdateInfo=null,this._weapon=null,this.animationStep=0,this.bodySprite=new l["a"],this.bodySprite.texture=new c["Texture"](e.texture.baseTexture,new c["Rectangle"](e.offset.x,e.offset.y,e.width,e.height)),this.bodySprite.anchor.set(.5,1);var r=new c["Texture"](e.texture.baseTexture,new c["Rectangle"](224,0,32,32));this.shadowSprite=new l["a"],this.shadowSprite.texture=r,this.shadowSprite.alpha=.5,this.shadowSprite.anchor.set(.5,.5),this.debugCircle=new c["Graphics"],this.debugCircle.lineStyle(2,16733525,1),this.debugCircle.alpha=.7,this.debugCircle.drawCircle(0,0,11),this.debugRect=new c["Graphics"],this.debugRect.lineStyle(2,5592575,1),this.debugRect.alpha=.7,this.debugRect.drawRect(this.hitRect.x,this.hitRect.y,this.hitRect.width,this.hitRect.height)}return Object(n["a"])(t,[{key:"weapon",set:function(t){this._weapon=t,this._weapon.character=this,this._weapon.field=this.field}},{key:"currentDirection",get:function(){return this._currentDirection},set:function(t){this._currentDirection=t,this.syncTexture()}},{key:"routine",set:function(t){this._routine=t,this._routine.character=this}},{key:"onAddToField",value:function(){this.field.debugLayerContainer.addChild(this.debugCircle),this.field.debugLayerContainer.addChild(this.debugRect),this.field.layerContainer.addChildZ(this.shadowSprite,0),this.field.layerContainer.addChildZ(this.bodySprite,0)}},{key:"onRemoveFromField",value:function(){this.field.debugLayerContainer.removeChild(this.debugCircle),this.field.debugLayerContainer.removeChild(this.debugRect),this.field.layerContainer.removeChild(this.shadowSprite),this.field.layerContainer.removeChild(this.bodySprite)}},{key:"syncTexture",value:function(){var t=0,e=0;if(8===this.textureInfo.directionNum)switch(this.currentDirection){case 1:t=96;break;case 2:break;case 3:t=96,e=64;break;case 4:e=64;break;case 6:e=128;break;case 7:t=96,e=128;break;case 8:e=192;break;case 9:t=96,e=192;break}t+=(3===this.animationStep?1:this.animationStep)*this.textureInfo.width;var i=new c["Rectangle"](this.textureInfo.offset.x+t,this.textureInfo.offset.y+e,this.textureInfo.width,this.textureInfo.height);this.bodySprite.texture.frame=i}},{key:"preUpdate",value:function(){null!=this._weapon&&this._weapon.isAttacking||this._routine.preUpdate()}},{key:"update",value:function(){null!=this._weapon&&this._weapon.isAttacking&&this._weapon.update();var t=[this.x,this.y+8];this.bodySprite.x=t[0],this.bodySprite.y=t[1];var e=[this.x,this.y];this.shadowSprite.x=e[0],this.shadowSprite.y=e[1];var i=[this.x,this.y];this.hitCircle.x=i[0],this.hitCircle.y=i[1];var r=[this.x,this.y];this.debugCircle.x=r[0],this.debugCircle.y=r[1];var a=[this.x-12,this.y-12];this.hitRect.x=a[0],this.hitRect.y=a[1];var s=[this.x,this.y];this.debugRect.x=s[0],this.debugRect.y=s[1],this.bodySprite.zOrder=this.shadowSprite.zOrder=this.bodySprite.position.y,++this.animationFrame,this.animationFrame>30&&(this.animationFrame=0,this.animationStep=(this.animationStep+1)%4,this.syncTexture())}},{key:"attack",value:function(){null!=this._weapon&&this._weapon.onAddToField()}}]),t}(),x=function t(){Object(h["a"])(this,t)},w=37,S=38,b=39,A=40,M=function(t,e){var i=.7*e;switch(t){case 1:return[-i,i];case 2:return[0,e];case 3:return[i,i];case 4:return[-e,0];case 6:return[e,0];case 7:return[-i,-i];case 8:return[0,-e];case 9:return[i,-i]}return[0,0]},k=function(t){Object(d["a"])(i,t);var e=Object(u["a"])(i);function i(t){var r;return Object(h["a"])(this,i),r=e.call(this),r.inputManager=t,r}return Object(n["a"])(i,[{key:"preUpdate",value:function(){var t=null;if(this.inputManager.isPressing(w)?t=this.inputManager.isPressing(A)?1:this.inputManager.isPressing(S)?7:4:this.inputManager.isPressing(b)?t=this.inputManager.isPressing(A)?3:this.inputManager.isPressing(S)?9:6:this.inputManager.isPressing(S)?t=8:this.inputManager.isPressing(A)&&(t=2),null!=t){var e=M(t,3),i=Object(s["a"])(e,2),r=i[0],a=i[1];this.character.preUpdateInfo=new f(r,a,t)}this.inputManager.isReleased(90)&&this.character.attack()}}]),i}(x),T=function(t){Object(d["a"])(i,t);var e=Object(u["a"])(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;return Object(h["a"])(this,i),t=e.call(this),t.isMoving=r,t.frameCountToWait=a,t.frameCountToMove=s,t}return Object(n["a"])(i,[{key:"preUpdate",value:function(){if(this.isMoving){var t=M(this.character.currentDirection,1),e=Object(s["a"])(t,2),i=e[0],r=e[1];this.character.preUpdateInfo=new f(i,r,this.character.currentDirection),--this.frameCountToWait,this.frameCountToWait<=0&&(this.frameCountToWait=0,this.frameCountToMove=60+30*Math.floor(3*Math.random()),this.isMoving=!1)}else if(--this.frameCountToMove,this.frameCountToMove<=0){this.frameCountToMove=0,this.frameCountToWait=60;var a=[1,2,3,4,6,7,8,9][Math.floor(8*Math.random())];this.character.preUpdateInfo=new f(0,0,a),this.isMoving=!0}}}]),i}(x),D=(i("99af"),i("45fc"),i("0d03"),i("25f0"),i("d820")),I=i("5e0f"),F=3,G=640,O=480,R=G/3,P=O/3,j=function t(e,i,r,a,s){Object(h["a"])(this,t),this.type=e,this.left=i,this.top=r,this.right=a,this.bottom=s},L=function t(e,i,r){Object(h["a"])(this,t),this.character=e,this.areaGridX=i,this.areaGridY=r,this.isAdded=!1},_=function(t){Object(d["a"])(i,t);var e=Object(u["a"])(i);function i(t,r,a){var s;return Object(h["a"])(this,i),s=e.call(this),s.texture=t,s.mapChipData=r,s.mapData=a,s.horizontalGridNum=200,s.verticalGridNum=200,s.targetCharacter=null,s.fieldCharacters=[],s.inSightArea=new c["Rectangle"],s.walls=[],s.collisions=[],s.collisionsByArea=new Map,s.fieldCharactersByArea=new Map,s.textureMap=new Map,s.textureList=[],s.frameCount=0,I["b"].use32bitIndex=!0,s.sortableChildren=!0,s.bgLayerContainer=new I["a"](0,[t]),s.layerContainer=new D["a"](2e4,{uvs:!0,vertices:!0,tint:!0,rotation:!0}),s.airLayerContainer=new I["a"](0,[t]),s.debugLayerContainer=new c["Container"],s.debugLayerContainer.visible=!1,s.addChild(s.bgLayerContainer),s.addChild(s.layerContainer),s.addChild(s.airLayerContainer),s.addChild(s.debugLayerContainer),s.generateMap(),s.inSightArea.width=Math.ceil(G/(F*s.mapData.tilewidth))+4,s.inSightArea.height=Math.ceil(O/(F*s.mapData.tileheight))+4,s.updateInSightArea(),s.on("added",(function(){})),s}return Object(n["a"])(i,[{key:"reloadMap",value:function(t){this.mapData=t,this.clearMap(),this.generateMap()}},{key:"clearMap",value:function(){this.textureMap.forEach((function(t){return t.destroy()})),this.textureMap.clear(),this.bgLayerContainer.clear(),this.airLayerContainer.clear(),this.walls.length=0}},{key:"generateMap",value:function(){this.textureList.forEach((function(t){return t.destroy()})),this.textureList.length=0;for(var t=0,e=Math.floor(this.mapChipData.imageheight/this.mapChipData.tileheight);t<e;++t)for(var i=0,r=Math.floor(this.mapChipData.imagewidth/this.mapChipData.tilewidth);i<r;++i){var a=this.texture.clone();a.frame=new c["Rectangle"](this.mapChipData.tilewidth*i,this.mapChipData.tileheight*t,this.mapChipData.tilewidth,this.mapChipData.tileheight),this.textureList.push(a)}this.horizontalGridNum=this.mapData.width,this.verticalGridNum=this.mapData.height;for(var s=0;s<this.verticalGridNum;++s)for(var h=0;h<this.horizontalGridNum;++h){for(var n=h+s*this.horizontalGridNum,o=0;o<3;++o){var d=this.mapData.layers[o].data[n];d>0&&this.bgLayerContainer.addFrame(this.textureList[d-1],h*this.mapChipData.tilewidth,s*this.mapChipData.tileheight)}var u=this.mapData.layers[3].data[n];u>0&&this.airLayerContainer.addFrame(this.textureList[u-1],h*this.mapChipData.tilewidth,s*this.mapChipData.tileheight);var l=this.mapData.tilesets.filter((function(t){return"collosion.json"===t.source}))[0].firstgid,f=this.mapData.layers[4].data[n];f>0&&(this.collisions[s*this.horizontalGridNum+h]=new j(f-l,h*this.mapData.tilewidth,s*this.mapData.tileheight,h*this.mapData.tilewidth+this.mapData.tilewidth,s*this.mapData.tileheight+this.mapData.tileheight))}for(var p=0;p<this.verticalGridNum;++p)for(var g=0;g<this.horizontalGridNum;++g){var m=this.collisions[p*this.horizontalGridNum+g];if(null!=m){var y=this.gridToAreaGrid(g,p).toString();this.collisionsByArea.has(y)?this.collisionsByArea.get(y).push(m):this.collisionsByArea.set(y,[m])}}}},{key:"setTargetCharacter",value:function(t){this.targetCharacter=t}},{key:"addCharacter",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.positionToAreaGrid(t.x,t.y),r=Object(s["a"])(i,2),a=r[0],h=r[1],n=new L(t,a,h);this.fieldCharacters.push(n),this.addFieldCharacterToArea(n,a,h),e&&this.setTargetCharacter(t),t.update(),this.isInSight(n)&&(t.onAddToField(),n.isAdded=!0)}},{key:"removeCharacter",value:function(t){var e=this;this.targetCharacter===t&&(this.targetCharacter=null),t.onRemoveFromField(),this.fieldCharacters=this.fieldCharacters.filter((function(i){return i.character!==t||(e.removeFieldCharacterFromArea(i,i.areaGridX,i.areaGridY),!1)}))}},{key:"update",value:function(){var t=this,e=this.getInSightFieldCharacters();e.forEach((function(t){return t.character.preUpdate()})),e.forEach((function(e){if(null!=e.character.preUpdateInfo){var i=[e.character.preUpdateInfo.moveX,e.character.preUpdateInfo.moveY],r=i[0],a=i[1];if(0!=r||0!=a){var h=t.hitOtherCaracter(e,r,a),n=Object(s["a"])(h,2),o=n[0],c=n[1];o&&(r-=r*c,a-=a*c);var d=t.hitWall(e.character,r,a),u=Object(s["a"])(d,3),l=u[0],f=u[1],p=u[2];l?0===f||0===p?(e.character.x+=r-f,e.character.y+=a-p):t.hitWall(e.character,0,a)[0]?t.hitWall(e.character,r,0)[0]||(e.character.x+=r,e.character.y+=a-p):(e.character.y+=a,e.character.x+=r-f):(e.character.x+=r,e.character.y+=a)}e.character.currentDirection=e.character.preUpdateInfo.nextDirection,e.character.preUpdateInfo=null;var g=[e.areaGridX,e.areaGridY],m=g[0],y=g[1];e.character.update();var C=t.positionToAreaGrid(e.character.x,e.character.y),v=Object(s["a"])(C,2);e.areaGridX=v[0],e.areaGridY=v[1],e.areaGridX===m&&e.areaGridY===y||(t.removeFieldCharacterFromArea(e,m,y),t.addFieldCharacterToArea(e,e.areaGridX,e.areaGridY),t.isInSight(e)||(e.character.onRemoveFromField(),e.isAdded=!1))}else e.character.update()}));var i=G-R,r=R,a=O-P,h=P;if(this.targetCharacter){var n=this.targetCharacter.x+this.x;n>i?this.x=-(this.targetCharacter.x-i):n<r&&(this.x=-(this.targetCharacter.x-r));var o=this.targetCharacter.y+this.y;o>a?this.y=-(this.targetCharacter.y-a):o<h&&(this.y=-(this.targetCharacter.y-h));var c=[this.inSightArea.x,this.inSightArea.y],d=c[0],u=c[1];this.updateInSightArea();var l=this.inSightArea.x-d,f=this.inSightArea.y-u;this.updateCharacterVisibilityByMovedAreaOffset(l,f)}this.x=Math.floor(Math.min(0,Math.max(-(this.mapData.tilewidth*this.horizontalGridNum-G),this.x))),this.y=Math.floor(Math.min(0,Math.max(-(this.mapData.tileheight*this.verticalGridNum-O),this.y))),this.layerContainer.sortChildren(),++this.frameCount}},{key:"hitOtherCaracter",value:function(t,e,i){var r=t.character.hitCircle.clone();r.x+=e,r.y+=i;var a=0,s=this.getOtherFieldCharactersByAreaGrid(t),h=s.some((function(t){var e=[r.x,r.y,t.character.hitCircle.x,t.character.hitCircle.y],i=e[0],s=e[1],h=e[2],n=e[3];a=r.radius+t.character.hitCircle.radius-Math.sqrt(Math.pow(h-i,2)+Math.pow(n-s,2));var o=a>=0;return o}));return[h,h?a/Math.sqrt(Math.pow(e,2)+Math.pow(i,2)):0]}},{key:"hitWall",value:function(t,e,i){var r=this.positionToAreaGrid(t.x,t.y),a=this.getCollisionsByAreaGrid(r),s=t.hitRect.clone();s.x+=e,s.y+=i;var h=0,n=0,o=a.some((function(t){var r=s.left<t.right&&s.right>t.left,a=s.top<t.bottom&&s.bottom>t.top,o=r&&a;return o&&(e<0?h=s.left-t.right:e>0&&(h=s.right-t.left),i<0?n=s.top-t.bottom:i>0&&(n=s.bottom-t.top)),o}));return[o,h,n]}},{key:"getOtherFieldCharactersByAreaGrid",value:function(t){var e=this,i=[],r=[t.areaGridX,t.areaGridY],a=[r.toString(),[r[0]-1,r[1]].toString(),[r[0]-1,r[1]-1].toString(),[r[0],r[1]-1].toString(),[r[0]+1,r[1]-1].toString(),[r[0]+1,r[1]].toString(),[r[0]+1,r[1]+1].toString(),[r[0],r[1]+1].toString(),[r[0]-1,r[1]+1].toString()];return a.forEach((function(t){e.fieldCharactersByArea.has(t)&&Array.prototype.push.apply(i,e.fieldCharactersByArea.get(t))})),i.filter((function(e){return e!==t}))}},{key:"getCollisionsByAreaGrid",value:function(t){var e=this,i=[],r=[t.toString(),[t[0]-1,t[1]].toString(),[t[0]-1,t[1]-1].toString(),[t[0],t[1]-1].toString(),[t[0]+1,t[1]-1].toString(),[t[0]+1,t[1]].toString(),[t[0]+1,t[1]+1].toString(),[t[0],t[1]+1].toString(),[t[0]-1,t[1]+1].toString()];return r.forEach((function(t){e.collisionsByArea.has(t)&&Array.prototype.push.apply(i,e.collisionsByArea.get(t))})),i}},{key:"addFieldCharacterToArea",value:function(t,e,i){var r=[e,i].toString();this.fieldCharactersByArea.has(r)?this.fieldCharactersByArea.get(r).push(t):this.fieldCharactersByArea.set(r,[t])}},{key:"removeFieldCharacterFromArea",value:function(t,e,i){var r=[e,i].toString(),a=this.fieldCharactersByArea.get(r);this.fieldCharactersByArea.set(r,a.filter((function(e){return e!==t})))}},{key:"gridToAreaGrid",value:function(t,e){return[Math.floor(t/F),Math.floor(e/F)]}},{key:"positionToAreaGrid",value:function(t,e){return[Math.floor(t/(F*this.mapData.tilewidth)),Math.floor(e/(F*this.mapData.tileheight))]}},{key:"setDebugMode",value:function(t){this.debugLayerContainer.visible=t}},{key:"getInSightFieldCharacters",value:function(){for(var t=[],e=this.inSightArea.top;e<=this.inSightArea.bottom;++e)for(var i=this.inSightArea.left;i<=this.inSightArea.right;++i){var r=[i,e].toString();this.fieldCharactersByArea.has(r)&&Array.prototype.push.apply(t,this.fieldCharactersByArea.get(r))}return t}},{key:"updateInSightArea",value:function(){this.inSightArea.x=Math.max(0,-Math.floor(this.x/(F*this.mapData.tilewidth))-2),this.inSightArea.y=Math.max(0,-Math.floor(this.y/(F*this.mapData.tileheight))-2)}},{key:"isInSight",value:function(t){return t.areaGridX>=this.inSightArea.left&&t.areaGridX<=this.inSightArea.right&&t.areaGridY>=this.inSightArea.top&&t.areaGridY<=this.inSightArea.bottom}},{key:"updateCharacterVisibilityByMovedAreaOffset",value:function(t,e){if(0!==t){for(var i=t>0?this.inSightArea.right-t+1:this.inSightArea.left,r=t>0?this.inSightArea.right:this.inSightArea.left-t-1,a=i;a<=r;++a)for(var s=this.inSightArea.top;s<=this.inSightArea.bottom;++s){var h=[a,s].toString();this.fieldCharactersByArea.has(h)&&this.fieldCharactersByArea.get(h).forEach((function(t){t.isAdded||(t.character.onAddToField(),t.isAdded=!0)}))}console.log("movedAreaX = ".concat(t));var n=t>0?this.inSightArea.left-t:this.inSightArea.right+1,o=t>0?this.inSightArea.left-1:this.inSightArea.right-t;console.log("startX: ".concat(n,", endX: ").concat(o));for(var c=n;c<=o;++c)for(var d=this.inSightArea.top;d<=this.inSightArea.bottom;++d){var u=[c,d].toString();console.log(u),this.fieldCharactersByArea.has(u)&&this.fieldCharactersByArea.get(u).forEach((function(t){t.isAdded&&(t.character.onRemoveFromField(),t.isAdded=!1)}))}}if(0!==e){for(var l=e>0?this.inSightArea.bottom-e+1:this.inSightArea.top,f=e>0?this.inSightArea.bottom:this.inSightArea.top-e-1,p=l;p<=f;++p)for(var g=this.inSightArea.left;g<=this.inSightArea.right;++g){var m=[g,p].toString();this.fieldCharactersByArea.has(m)&&this.fieldCharactersByArea.get(m).forEach((function(t){t.isAdded||(t.character.onAddToField(),t.isAdded=!0)}))}for(var y=e>0?this.inSightArea.top-e:this.inSightArea.bottom+1,C=e>0?this.inSightArea.top-1:this.inSightArea.bottom-e,v=y;v<=C;++v)for(var x=this.inSightArea.left;x<=this.inSightArea.right;++x){var w=[x,v].toString();this.fieldCharactersByArea.has(w)&&this.fieldCharactersByArea.get(w).forEach((function(t){t.isAdded&&(t.character.onRemoveFromField(),t.isAdded=!1)}))}}}}]),i}(c["Container"]),B=i("1219"),E=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:performance.now();Object(h["a"])(this,t),this.oldNow=e,this.ms=0,this.counter=0,this.averageMs=0}return Object(n["a"])(t,[{key:"checkPoint",value:function(){var t=performance.now();this.ms+=t-this.oldNow,this.oldNow=t,++this.counter,this.counter>=60&&(this.averageMs=this.ms/this.counter,this.counter=0,this.ms=0)}}]),t}(),N=o["default"].extend({data:function(){return{pixiApp:null,renderTexture:null,field:null,inputManager:new B["a"],fpsCounter:new E,characters:[],isDebugMode:!1}},mounted:function(){var t=this;c["settings"].RESOLUTION=window.devicePixelRatio,c["settings"].SCALE_MODE=c["SCALE_MODES"].NEAREST,window.onkeydown=this.onKeyDown,window.onkeyup=this.onKeyUp;var e={width:640,height:480,autoDensity:!0};this.pixiApp=new c["Application"](e),this.pixiApp.ticker.maxFPS=60,this.pixiApp.ticker.minFPS=60;var i=this.$refs["pixi_area"];i.appendChild(this.pixiApp.view);var r=new c["Sprite"](c["Texture"].WHITE);r.width=320,r.height=240,r.tint=13421772,this.pixiApp.stage.addChild(r),c["utils"].clearTextureCache(),c["Loader"].shared.reset().add("/arpg-sample/images/stages/014/chara01.png").add("/arpg-sample/images/stages/014/chara02.png").add("/arpg-sample/images/stages/014/slime-blue.png").add("/arpg-sample/images/stages/014/slime-red.png").add("/arpg-sample/images/stages/014/slime-yellow.png").add("/arpg-sample/images/stages/015/sword.png").add("/arpg-sample/images/stages/015/knife.png").add("/arpg-sample/images/stages/013/mapchip.png").add("/arpg-sample/images/stages/013/mapchip.json").add("/arpg-sample/images/stages/013/map01.json").load((function(){t.renderTexture=c["RenderTexture"].create({width:1024,height:1024});c["Sprite"].from(t.renderTexture);var e=c["Sprite"].from(c["Loader"].shared.resources["/arpg-sample/images/stages/013/mapchip.png"].texture);t.pixiApp.renderer.render(e,t.renderTexture,!1);var i=c["Sprite"].from(c["Loader"].shared.resources["/arpg-sample/images/stages/014/chara01.png"].texture);i.position.set(256,0),t.pixiApp.renderer.render(i,t.renderTexture,!1);var r=c["Sprite"].from(c["Loader"].shared.resources["/arpg-sample/images/stages/014/chara02.png"].texture);r.position.set(448,0),t.pixiApp.renderer.render(r,t.renderTexture,!1);var a=c["Sprite"].from(c["Loader"].shared.resources["/arpg-sample/images/stages/014/slime-blue.png"].texture);a.position.set(640,0),t.pixiApp.renderer.render(a,t.renderTexture,!1);var s=c["Sprite"].from(c["Loader"].shared.resources["/arpg-sample/images/stages/014/slime-red.png"].texture);s.position.set(640,32),t.pixiApp.renderer.render(s,t.renderTexture,!1);var h=c["Sprite"].from(c["Loader"].shared.resources["/arpg-sample/images/stages/014/slime-yellow.png"].texture);h.position.set(640,64),t.pixiApp.renderer.render(h,t.renderTexture,!1);var n=c["Sprite"].from(c["Loader"].shared.resources["/arpg-sample/images/stages/015/knife.png"].texture);n.position.set(640,96),t.pixiApp.renderer.render(n,t.renderTexture,!1);var o=c["Sprite"].from(c["Loader"].shared.resources["/arpg-sample/images/stages/015/sword.png"].texture);o.position.set(640,160),t.pixiApp.renderer.render(o,t.renderTexture,!1),t.field=new _(t.renderTexture,c["Loader"].shared.resources["/arpg-sample/images/stages/013/mapchip.json"].data,c["Loader"].shared.resources["/arpg-sample/images/stages/013/map01.json"].data),t.pixiApp.stage.addChild(t.field),t.generateCharacter(0),t.generateCharacter(1),t.generateCharacter(2),t.generateCharacter(3),t.generateCharacter(4),t.field.setTargetCharacter(t.characters[0]),t.characters[0].weapon=new C(new p(t.renderTexture,new c["Point"](640,96),64,64,1)),t.characters[1].weapon=new C(new p(t.renderTexture,new c["Point"](640,160),64,64,1))})),this.pixiApp.ticker.add(this.update)},methods:{onKeyDown:function(t){this.inputManager.onKeyDown(t.keyCode)},onKeyUp:function(t){this.inputManager.onKeyUp(t.keyCode)},update:function(t){var e=this;this.fpsCounter.checkPoint(),this.inputManager.isReleased(32)&&this.toggleCharacter(),this.inputManager.isReleased(49)&&this.onClickToggleDebugMode(),this.inputManager.isReleased(46)&&(this.characters=this.characters.filter((function(t){return t!==e.field.targetCharacter})),this.field.removeCharacter(this.field.targetCharacter),this.characters.length>0&&this.toggleCharacter()),null!=this.field&&this.field.update(),this.inputManager.endTurn()},onClickToggleDebugMode:function(){this.isDebugMode=!this.isDebugMode,this.field.setDebugMode(this.isDebugMode)},isFocusedCharacter:function(t){return this.field.targetCharacter===t},onClickCharacterCell:function(t){this.field.setTargetCharacter(t)},onClickDeleteCharacter:function(t){this.characters=this.characters.filter((function(e){return e!==t})),this.field.removeCharacter(t)},generateCharacter:function(t){var e=null,i=0,r=0,a=0;switch(t){case 0:case 1:i=32,r=64,a=8;break;case 2:case 3:case 4:i=32,r=32,a=1;break}switch(t){case 0:e=new c["Point"](256,0);break;case 1:e=new c["Point"](448,0);break;case 2:e=new c["Point"](640,0);break;case 3:e=new c["Point"](640,32);break;case 4:e=new c["Point"](640,64);break}var h=new v(new p(this.renderTexture,e,i,r,a),this.field);for(h.routine=0===t?new k(this.inputManager):new T,h.currentDirection=4;;){h.x=32+16*Math.floor(Math.random()*(this.field.horizontalGridNum-4)),h.y=32+16*Math.floor(Math.random()*(this.field.verticalGridNum-4)),this.field.addCharacter(h,!1);var n=this.field.hitWall(h,0,0),o=Object(s["a"])(n,3),d=o[0];o[1],o[2];if(!d)break;this.field.removeCharacter(h),console.log(d)}this.characters.push(h),h.type=t},toggleCharacter:function(){var t=this,e=0;this.characters.forEach((function(i,r){i===t.field.targetCharacter&&(e=r)}));var i=(e+1)%this.characters.length,r=this.characters[e],a=this.characters[i];r.routine=new T,a.routine=new k(this.inputManager),this.field.setTargetCharacter(a)}},beforeDestroy:function(){this.pixiApp.destroy(!0)},components:{},computed:{},props:[]}),K=N,U=(i("2ea5"),i("2877")),X=Object(U["a"])(K,r,a,!1,null,"61311f8e",null);e["default"]=X.exports},"99af":function(t,e,i){"use strict";var r=i("23e7"),a=i("d039"),s=i("e8b5"),h=i("861d"),n=i("7b0b"),o=i("50c4"),c=i("8418"),d=i("65f0"),u=i("1dde"),l=i("b622"),f=i("2d00"),p=l("isConcatSpreadable"),g=9007199254740991,m="Maximum allowed index exceeded",y=f>=51||!a((function(){var t=[];return t[p]=!1,t.concat()[0]!==t})),C=u("concat"),v=function(t){if(!h(t))return!1;var e=t[p];return void 0!==e?!!e:s(t)},x=!y||!C;r({target:"Array",proto:!0,forced:x},{concat:function(t){var e,i,r,a,s,h=n(this),u=d(h,0),l=0;for(e=-1,r=arguments.length;e<r;e++)if(s=-1===e?h:arguments[e],v(s)){if(a=o(s.length),l+a>g)throw TypeError(m);for(i=0;i<a;i++,l++)i in s&&c(u,l,s[i])}else{if(l>=g)throw TypeError(m);c(u,l++,s)}return u.length=l,u}})}}]);
//# sourceMappingURL=chunk-42beaf9a.68590142.js.map